# 神经元轨迹平滑功能说明

## 功能概述

本次更新为 `show_trace.py` 添加了曲线平滑功能，使生成的神经元钙离子浓度轨迹图更加平滑美观。

## 新增功能

### 1. 数据平滑处理
- 使用 Savitzky-Golay 滤波器对钙离子浓度数据进行平滑处理
- 保持数据特征的同时减少噪声
- 可调节平滑参数以获得不同的平滑效果

### 2. 插值处理
- 使用三次样条插值增加数据点密度
- 使曲线更加连续流畅
- 提高图表的视觉质量

## 新增命令行参数

```bash
--smooth                # 是否启用平滑处理（默认启用）
--smooth-window INT     # 平滑窗口大小，必须为奇数（默认为11）
--smooth-poly INT       # 平滑多项式阶数（默认为3）
```

## 使用示例

### 1. 使用默认平滑参数
```bash
python show_trace.py --input data.xlsx --output-dir results/
```

### 2. 自定义平滑参数
```bash
python show_trace.py --input data.xlsx --output-dir results/ \
    --smooth-window 15 --smooth-poly 2
```

### 3. 禁用平滑功能
```bash
python show_trace.py --input data.xlsx --output-dir results/ \
    --no-smooth
```

### 4. 强力平滑设置（用于噪声较大的数据）
```bash
python show_trace.py --input data.xlsx --output-dir results/ \
    --smooth-window 21 --smooth-poly 3
```

## 参数说明

### smooth-window (平滑窗口大小)
- **取值范围**: 必须为奇数，且 ≥ 3
- **推荐值**: 9-15
- **效果**: 
  - 较小值（如7-9）: 保留更多细节，轻微平滑
  - 中等值（如11-13）: 平衡平滑度和细节保留
  - 较大值（如15-21）: 强力平滑，可能丢失一些细节

### smooth-poly (多项式阶数)
- **取值范围**: 1-5
- **推荐值**: 2-3
- **效果**:
  - 低阶（1-2）: 更平滑但可能过度简化
  - 高阶（3-4）: 保留更多数据特征
  - 过高阶（≥5）: 可能引入伪影

## 技术细节

### 平滑算法
- **Savitzky-Golay滤波器**: 在局部窗口内拟合多项式，保持数据的统计矩
- **三次样条插值**: 在原数据点间插入新点，使曲线更平滑

### 自动参数调整
- 当数据长度小于指定窗口大小时，程序会自动调整窗口大小
- 错误处理：如果平滑失败，程序会自动返回原始数据

## 效果对比

### 原始效果
- 曲线可能存在锯齿状波动
- 数据点间连接较为生硬

### 平滑后效果
- 曲线更加连续流畅
- 保持主要趋势的同时减少噪声
- 视觉效果更加专业

## 注意事项

1. **数据保真性**: 平滑处理会改变原始数据，请根据分析需求选择合适的参数
2. **计算时间**: 启用平滑和插值功能会增加少量计算时间
3. **参数选择**: 建议先使用默认参数，然后根据效果调整

## 依赖包

确保安装了以下Python包：
```bash
pip install scipy numpy matplotlib pandas
``` 